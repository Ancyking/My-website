<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tenant Management System</title>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --success-color: #2ecc71;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--secondary-color);
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
        }
        
        nav ul {
            display: flex;
            list-style: none;
        }
        
        nav ul li {
            margin-left: 20px;
        }
        
        nav ul li a {
            color: white;
            text-decoration: none;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }
        
        nav ul li a:hover, nav ul li a.active {
            background-color: var(--primary-color);
        }
        
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .card {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .card h3 {
            color: var(--secondary-color);
            margin-bottom: 10px;
        }
        
        .card .value {
            font-size: 28px;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .section {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .btn {
            padding: 8px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-success {
            background-color: var(--success-color);
            color: white;
        }
        
        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }
        
        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }
        
        .btn:hover {
            opacity: 0.9;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        table th, table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        table th {
            background-color: var(--light-color);
            color: var(--secondary-color);
        }
        
        table tr:hover {
            background-color: #f9f9f9;
        }
        
        .action-buttons {
            display: flex;
            gap: 5px;
        }
        
        .action-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        
        .form-row {
            display: flex;
            gap: 15px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 8px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .close {
            font-size: 24px;
            cursor: pointer;
            color: #aaa;
        }
        
        .close:hover {
            color: #000;
        }
        
        .search-box {
            display: flex;
            margin-bottom: 20px;
        }
        
        .search-box input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px 0 0 4px;
        }
        
        .search-box button {
            padding: 10px 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
        }
        
        .tab-container {
            margin-top: 20px;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--primary-color);
            color: var(--primary-color);
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .utility-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .utility-item:last-child {
            border-bottom: none;
        }
        
        .status-badge {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-paid {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-due {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .room-occupied {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .room-vacant {
            background-color: #d4edda;
            color: #155724;
        }
        
        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
                gap: 0;
            }
            
            .dashboard-cards {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                text-align: center;
            }
            
            nav ul {
                margin-top: 10px;
                justify-content: center;
            }
            
            table {
                display: block;
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">Tenant Management System</div>
                <nav>
                    <ul>
                        <li><a href="#" class="nav-link active" data-target="dashboard">Dashboard</a></li>
                        <li><a href="#" class="nav-link" data-target="tenants">Tenants</a></li>
                        <li><a href="#" class="nav-link" data-target="utilities">Utilities</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>
    
    <div class="container">
        <!-- Dashboard Section -->
        <section id="dashboard" class="section active">
            <h2>Dashboard Overview</h2>
            
            <div class="dashboard-cards">
                <div class="card">
                    <h3>Total Tenants</h3>
                    <div class="value" id="total-tenants">0</div>
                </div>
                <div class="card">
                    <h3>Total Rent Paid</h3>
                    <div class="value" id="total-rent">$0</div>
                </div>
                <div class="card">
                    <h3>Total Deposit Paid</h3>
                    <div class="value" id="total-deposit">$0</div>
                </div>
                <div class="card">
                    <h3>Rent Due</h3>
                    <div class="value" id="rent-due">$0</div>
                </div>
            </div>
            
            <div class="section">
                <div class="section-header">
                    <h3>Room Occupancy</h3>
                </div>
                <div id="rooms-grid">
                    <!-- Rooms will be dynamically generated here -->
                </div>
            </div>
            
            <div class="section">
                <div class="section-header">
                    <h3>Recent Payments</h3>
                </div>
                <table id="recent-payments">
                    <thead>
                        <tr>
                            <th>Tenant</th>
                            <th>Room</th>
                            <th>Amount</th>
                            <th>Date</th>
                            <th>Type</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Recent payments will be dynamically generated here -->
                    </tbody>
                </table>
            </div>
        </section>
        
        <!-- Tenants Section -->
        <section id="tenants" class="section">
            <div class="section-header">
                <h2>Tenant Management</h2>
                <button class="btn btn-primary" id="add-tenant-btn">Add New Tenant</button>
            </div>
            
            <div class="search-box">
                <input type="text" id="search-tenant" placeholder="Search tenants by name, room, or ID...">
                <button id="search-btn">Search</button>
            </div>
            
            <table id="tenants-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Phone</th>
                        <th>Room</th>
                        <th>Move-in Date</th>
                        <th>Rent Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Tenants will be dynamically generated here -->
                </tbody>
            </table>
        </section>
        
        <!-- Utilities Section -->
        <section id="utilities" class="section">
            <div class="section-header">
                <h2>Utility Payments</h2>
                <button class="btn btn-primary" id="add-utility-btn">Add Utility Payment</button>
            </div>
            
            <div class="tab-container">
                <div class="tabs">
                    <div class="tab active" data-tab="electricity">Electricity</div>
                    <div class="tab" data-tab="water">Water</div>
                    <div class="tab" data-tab="repairs">Repairs</div>
                    <div class="tab" data-tab="garbage">Garbage Fee</div>
                </div>
                
                <div class="tab-content active" id="electricity-tab">
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Tenant/Room</th>
                                <th>Amount</th>
                                <th>Description</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="electricity-payments">
                            <!-- Electricity payments will be dynamically generated here -->
                        </tbody>
                    </table>
                </div>
                
                <div class="tab-content" id="water-tab">
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Tenant/Room</th>
                                <th>Amount</th>
                                <th>Description</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="water-payments">
                            <!-- Water payments will be dynamically generated here -->
                        </tbody>
                    </table>
                </div>
                
                <div class="tab-content" id="repairs-tab">
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Tenant/Room</th>
                                <th>Amount</th>
                                <th>Description</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="repairs-payments">
                            <!-- Repairs payments will be dynamically generated here -->
                        </tbody>
                    </table>
                </div>
                
                <div class="tab-content" id="garbage-tab">
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Tenant/Room</th>
                                <th>Amount</th>
                                <th>Description</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="garbage-payments">
                            <!-- Garbage fee payments will be dynamically generated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </div>
    
    <!-- Add/Edit Tenant Modal -->
    <div id="tenant-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="tenant-modal-title">Add New Tenant</h2>
                <span class="close">&times;</span>
            </div>
            <form id="tenant-form">
                <input type="hidden" id="tenant-id">
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="tenant-name">Full Name</label>
                        <input type="text" id="tenant-name" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="tenant-phone">Phone Number</label>
                        <input type="tel" id="tenant-phone" class="form-control" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="tenant-address">Postal Address</label>
                    <input type="text" id="tenant-address" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <label for="tenant-id-card">Identification Card Number</label>
                    <input type="text" id="tenant-id-card" class="form-control" required>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="move-in-date">Move-in Date</label>
                        <input type="date" id="move-in-date" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="room-number">Room Number</label>
                        <select id="room-number" class="form-control" required>
                            <!-- Room options will be dynamically generated -->
                        </select>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="room-type">Room Type</label>
                        <select id="room-type" class="form-control" required>
                            <option value="single">Single Room</option>
                            <option value="double">Double Room</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="deposit-amount">Deposit Amount</label>
                        <input type="number" id="deposit-amount" class="form-control" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="rent-amount">Monthly Rent</label>
                    <input type="number" id="rent-amount" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Save Tenant</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Add Payment Modal -->
    <div id="payment-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="payment-modal-title">Add Payment</h2>
                <span class="close">&times;</span>
            </div>
            <form id="payment-form">
                <input type="hidden" id="payment-tenant-id">
                
                <div class="form-group">
                    <label for="payment-tenant">Tenant</label>
                    <select id="payment-tenant" class="form-control" required>
                        <!-- Tenant options will be dynamically generated -->
                    </select>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="payment-type">Payment Type</label>
                        <select id="payment-type" class="form-control" required>
                            <option value="rent">Rent</option>
                            <option value="deposit">Deposit</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="payment-amount">Amount</label>
                        <input type="number" id="payment-amount" class="form-control" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="payment-date">Payment Date</label>
                    <input type="datetime-local" id="payment-date" class="form-control" required>
                </div>
                
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Record Payment</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Add Utility Payment Modal -->
    <div id="utility-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="utility-modal-title">Add Utility Payment</h2>
                <span class="close">&times;</span>
            </div>
            <form id="utility-form">
                <div class="form-group">
                    <label for="utility-type">Utility Type</label>
                    <select id="utility-type" class="form-control" required>
                        <option value="electricity">Electricity</option>
                        <option value="water">Water</option>
                        <option value="repairs">Repairs</option>
                        <option value="garbage">Garbage Fee</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="utility-tenant">Tenant/Room</label>
                    <select id="utility-tenant" class="form-control" required>
                        <!-- Tenant/Room options will be dynamically generated -->
                    </select>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="utility-amount">Amount</label>
                        <input type="number" id="utility-amount" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="utility-date">Payment Date</label>
                        <input type="date" id="utility-date" class="form-control" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="utility-description">Description</label>
                    <textarea id="utility-description" class="form-control" rows="3"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="utility-status">Payment Status</label>
                    <select id="utility-status" class="form-control" required>
                        <option value="paid">Paid</option>
                        <option value="due">Due</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <button type="submit" class="btn btn-primary">Save Utility Payment</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Sample data structure
        let tenants = JSON.parse(localStorage.getItem('tenants')) || [];
        let payments = JSON.parse(localStorage.getItem('payments')) || [];
        let utilities = JSON.parse(localStorage.getItem('utilities')) || [];
        
        // Initialize rooms
        const rooms = [];
        for (let i = 1; i <= 18; i++) {
            rooms.push({
                number: `M${i}`,
                type: i % 2 === 0 ? 'double' : 'single', // Alternating room types for demo
                occupied: false,
                tenantId: null
            });
        }
        
        // Update room occupancy based on tenants
        function updateRoomOccupancy() {
            // Reset all rooms to vacant
            rooms.forEach(room => {
                room.occupied = false;
                room.tenantId = null;
            });
            
            // Mark occupied rooms
            tenants.forEach(tenant => {
                const room = rooms.find(r => r.number === tenant.roomNumber);
                if (room) {
                    room.occupied = true;
                    room.tenantId = tenant.id;
                }
            });
            
            // Update UI
            renderRoomsGrid();
        }
        
        // Generate unique IDs
        function generateId() {
            return '_' + Math.random().toString(36).substr(2, 9);
        }
        
        // Format currency
        function formatCurrency(amount) {
            return '$' + parseFloat(amount).toFixed(2);
        }
        
        // Format date
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString(undefined, options);
        }
        
        // Format datetime
        function formatDateTime(dateTimeString) {
            const options = { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            };
            return new Date(dateTimeString).toLocaleDateString(undefined, options);
        }
        
        // Render rooms grid
        function renderRoomsGrid() {
            const roomsGrid = document.getElementById('rooms-grid');
            roomsGrid.innerHTML = '';
            
            rooms.forEach(room => {
                const roomElement = document.createElement('div');
                roomElement.className = 'card';
                roomElement.style.display = 'inline-block';
                roomElement.style.width = 'calc(33.333% - 20px)';
                roomElement.style.margin = '10px';
                roomElement.style.verticalAlign = 'top';
                
                const statusClass = room.occupied ? 'room-occupied' : 'room-vacant';
                const statusText = room.occupied ? 'Occupied' : 'Vacant';
                
                let tenantName = 'Vacant';
                if (room.occupied) {
                    const tenant = tenants.find(t => t.id === room.tenantId);
                    if (tenant) tenantName = tenant.name;
                }
                
                roomElement.innerHTML = `
                    <h3>Room ${room.number}</h3>
                    <p>Type: ${room.type === 'single' ? 'Single' : 'Double'}</p>
                    <p>Status: <span class="status-badge ${statusClass}">${statusText}</span></p>
                    <p>Tenant: ${tenantName}</p>
                `;
                
                roomsGrid.appendChild(roomElement);
            });
        }
        
        // Render tenants table
        function renderTenantsTable(filteredTenants = null) {
            const tenantsTable = document.getElementById('tenants-table').getElementsByTagName('tbody')[0];
            tenantsTable.innerHTML = '';
            
            const tenantsToRender = filteredTenants || tenants;
            
            tenantsToRender.forEach(tenant => {
                const row = tenantsTable.insertRow();
                
                // Calculate rent status
                const rentPayments = payments.filter(p => 
                    p.tenantId === tenant.id && p.type === 'rent'
                );
                
                const lastRentPayment = rentPayments.length > 0 ? 
                    new Date(Math.max(...rentPayments.map(p => new Date(p.date)))) : 
                    null;
                
                const oneMonthAgo = new Date();
                oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);
                
                const rentStatus = lastRentPayment && lastRentPayment > oneMonthAgo ? 
                    '<span class="status-badge status-paid">Paid</span>' : 
                    '<span class="status-badge status-due">Due</span>';
                
                row.innerHTML = `
                    <td>${tenant.name}</td>
                    <td>${tenant.phone}</td>
                    <td>${tenant.roomNumber}</td>
                    <td>${formatDate(tenant.moveInDate)}</td>
                    <td>${rentStatus}</td>
                    <td class="action-buttons">
                        <button class="action-btn btn-primary edit-tenant" data-id="${tenant.id}">Edit</button>
                        <button class="action-btn btn-success add-payment" data-id="${tenant.id}">Payment</button>
                        <button class="action-btn btn-danger delete-tenant" data-id="${tenant.id}">Delete</button>
                    </td>
                `;
            });
            
            // Update dashboard stats
            updateDashboardStats();
        }
        
        // Render recent payments
        function renderRecentPayments() {
            const recentPaymentsTable = document.getElementById('recent-payments').getElementsByTagName('tbody')[0];
            recentPaymentsTable.innerHTML = '';
            
            // Sort payments by date (newest first) and take the latest 5
            const sortedPayments = [...payments].sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 5);
            
            sortedPayments.forEach(payment => {
                const tenant = tenants.find(t => t.id === payment.tenantId);
                if (!tenant) return;
                
                const row = recentPaymentsTable.insertRow();
                row.innerHTML = `
                    <td>${tenant.name}</td>
                    <td>${tenant.roomNumber}</td>
                    <td>${formatCurrency(payment.amount)}</td>
                    <td>${formatDateTime(payment.date)}</td>
                    <td>${payment.type === 'rent' ? 'Rent' : 'Deposit'}</td>
                `;
            });
        }
        
        // Render utility payments
        function renderUtilityPayments() {
            const utilityTypes = ['electricity', 'water', 'repairs', 'garbage'];
            
            utilityTypes.forEach(type => {
                const tableBody = document.getElementById(`${type}-payments`);
                tableBody.innerHTML = '';
                
                const typeUtilities = utilities.filter(u => u.type === type);
                
                typeUtilities.forEach(utility => {
                    const row = tableBody.insertRow();
                    
                    const statusClass = utility.status === 'paid' ? 'status-paid' : 'status-due';
                    const statusText = utility.status === 'paid' ? 'Paid' : 'Due';
                    
                    row.innerHTML = `
                        <td>${formatDate(utility.date)}</td>
                        <td>${utility.tenantRoom}</td>
                        <td>${formatCurrency(utility.amount)}</td>
                        <td>${utility.description || '-'}</td>
                        <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                        <td class="action-buttons">
                            <button class="action-btn btn-primary edit-utility" data-id="${utility.id}">Edit</button>
                            <button class="action-btn btn-danger delete-utility" data-id="${utility.id}">Delete</button>
                        </td>
                    `;
                });
            });
        }
        
        // Update dashboard statistics
        function updateDashboardStats() {
            document.getElementById('total-tenants').textContent = tenants.length;
            
            const totalRent = payments
                .filter(p => p.type === 'rent')
                .reduce((sum, payment) => sum + parseFloat(payment.amount), 0);
            document.getElementById('total-rent').textContent = formatCurrency(totalRent);
            
            const totalDeposit = payments
                .filter(p => p.type === 'deposit')
                .reduce((sum, payment) => sum + parseFloat(payment.amount), 0);
            document.getElementById('total-deposit').textContent = formatCurrency(totalDeposit);
            
            // Calculate rent due (simplified logic)
            const rentDue = tenants.length * 500 - totalRent; // Assuming $500 rent per tenant
            document.getElementById('rent-due').textContent = formatCurrency(Math.max(0, rentDue));
        }
        
        // Populate room options
        function populateRoomOptions() {
            const roomSelect = document.getElementById('room-number');
            roomSelect.innerHTML = '';
            
            rooms.forEach(room => {
                const option = document.createElement('option');
                option.value = room.number;
                option.textContent = `Room ${room.number} (${room.type === 'single' ? 'Single' : 'Double'}) ${room.occupied ? '- Occupied' : '- Vacant'}`;
                option.disabled = room.occupied;
                roomSelect.appendChild(option);
            });
        }
        
        // Populate tenant options for payments
        function populateTenantOptions() {
            const tenantSelect = document.getElementById('payment-tenant');
            tenantSelect.innerHTML = '';
            
            tenants.forEach(tenant => {
                const option = document.createElement('option');
                option.value = tenant.id;
                option.textContent = `${tenant.name} (${tenant.roomNumber})`;
                tenantSelect.appendChild(option);
            });
            
            // Also populate for utility payments
            const utilityTenantSelect = document.getElementById('utility-tenant');
            utilityTenantSelect.innerHTML = '';
            
            // Add all tenants
            tenants.forEach(tenant => {
                const option = document.createElement('option');
                option.value = `tenant-${tenant.id}`;
                option.textContent = `${tenant.name} (${tenant.roomNumber})`;
                utilityTenantSelect.appendChild(option);
            });
            
            // Add vacant rooms
            rooms.filter(room => !room.occupied).forEach(room => {
                const option = document.createElement('option');
                option.value = `room-${room.number}`;
                option.textContent = `Room ${room.number} (Vacant)`;
                utilityTenantSelect.appendChild(option);
            });
        }
        
        // Initialize the application
        function init() {
            // Set current date as default for move-in date
            document.getElementById('move-in-date').valueAsDate = new Date();
            document.getElementById('payment-date').value = new Date().toISOString().slice(0, 16);
            document.getElementById('utility-date').valueAsDate = new Date();
            
            // Populate dropdowns
            populateRoomOptions();
            populateTenantOptions();
            
            // Render initial data
            updateRoomOccupancy();
            renderTenantsTable();
            renderRecentPayments();
            renderUtilityPayments();
            
            // Set up event listeners
            setupEventListeners();
        }
        
        // Set up event listeners
        function setupEventListeners() {
            // Navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Update active nav link
                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show corresponding section
                    const target = this.getAttribute('data-target');
                    document.querySelectorAll('.section').forEach(section => {
                        section.classList.remove('active');
                    });
                    document.getElementById(target).classList.add('active');
                });
            });
            
            // Tab navigation for utilities
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Update active tab
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show corresponding tab content
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });
            
            // Modal close buttons
            document.querySelectorAll('.close').forEach(closeBtn => {
                closeBtn.addEventListener('click', function() {
                    this.closest('.modal').style.display = 'none';
                });
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal')) {
                    e.target.style.display = 'none';
                }
            });
            
            // Add tenant button
            document.getElementById('add-tenant-btn').addEventListener('click', function() {
                document.getElementById('tenant-modal-title').textContent = 'Add New Tenant';
                document.getElementById('tenant-form').reset();
                document.getElementById('tenant-id').value = '';
                populateRoomOptions();
                document.getElementById('tenant-modal').style.display = 'flex';
            });
            
            // Add payment button
            document.getElementById('add-payment-btn')?.addEventListener('click', function() {
                document.getElementById('payment-modal-title').textContent = 'Add Payment';
                document.getElementById('payment-form').reset();
                document.getElementById('payment-tenant-id').value = '';
                populateTenantOptions();
                document.getElementById('payment-date').value = new Date().toISOString().slice(0, 16);
                document.getElementById('payment-modal').style.display = 'flex';
            });
            
            // Add utility payment button
            document.getElementById('add-utility-btn').addEventListener('click', function() {
                document.getElementById('utility-modal-title').textContent = 'Add Utility Payment';
                document.getElementById('utility-form').reset();
                populateTenantOptions();
                document.getElementById('utility-date').valueAsDate = new Date();
                document.getElementById('utility-modal').style.display = 'flex';
            });
            
            // Tenant form submission
            document.getElementById('tenant-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const tenantId = document.getElementById('tenant-id').value;
                const formData = {
                    name: document.getElementById('tenant-name').value,
                    phone: document.getElementById('tenant-phone').value,
                    address: document.getElementById('tenant-address').value,
                    idCard: document.getElementById('tenant-id-card').value,
                    moveInDate: document.getElementById('move-in-date').value,
                    roomNumber: document.getElementById('room-number').value,
                    roomType: document.getElementById('room-type').value,
                    depositAmount: document.getElementById('deposit-amount').value,
                    rentAmount: document.getElementById('rent-amount').value
                };
                
                if (tenantId) {
                    // Edit existing tenant
                    const index = tenants.findIndex(t => t.id === tenantId);
                    if (index !== -1) {
                        tenants[index] = { ...tenants[index], ...formData };
                    }
                } else {
                    // Add new tenant
                    const newTenant = {
                        id: generateId(),
                        ...formData
                    };
                    tenants.push(newTenant);
                    
                    // Add deposit payment
                    if (formData.depositAmount > 0) {
                        payments.push({
                            id: generateId(),
                            tenantId: newTenant.id,
                            type: 'deposit',
                            amount: parseFloat(formData.depositAmount),
                            date: new Date().toISOString()
                        });
                    }
                }
                
                // Save to localStorage
                localStorage.setItem('tenants', JSON.stringify(tenants));
                localStorage.setItem('payments', JSON.stringify(payments));
                
                // Update UI
                updateRoomOccupancy();
                renderTenantsTable();
                populateTenantOptions();
                
                // Close modal
                document.getElementById('tenant-modal').style.display = 'none';
            });
            
            // Payment form submission
            document.getElementById('payment-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const paymentData = {
                    tenantId: document.getElementById('payment-tenant').value,
                    type: document.getElementById('payment-type').value,
                    amount: parseFloat(document.getElementById('payment-amount').value),
                    date: document.getElementById('payment-date').value
                };
                
                payments.push({
                    id: generateId(),
                    ...paymentData
                });
                
                // Save to localStorage
                localStorage.setItem('payments', JSON.stringify(payments));
                
                // Update UI
                renderTenantsTable();
                renderRecentPayments();
                updateDashboardStats();
                
                // Close modal
                document.getElementById('payment-modal').style.display = 'none';
            });
            
            // Utility form submission
            document.getElementById('utility-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const utilityData = {
                    type: document.getElementById('utility-type').value,
                    tenantRoom: document.getElementById('utility-tenant').value,
                    amount: parseFloat(document.getElementById('utility-amount').value),
                    date: document.getElementById('utility-date').value,
                    description: document.getElementById('utility-description').value,
                    status: document.getElementById('utility-status').value
                };
                
                utilities.push({
                    id: generateId(),
                    ...utilityData
                });
                
                // Save to localStorage
                localStorage.setItem('utilities', JSON.stringify(utilities));
                
                // Update UI
                renderUtilityPayments();
                
                // Close modal
                document.getElementById('utility-modal').style.display = 'none';
            });
            
            // Search functionality
            document.getElementById('search-btn').addEventListener('click', function() {
                const searchTerm = document.getElementById('search-tenant').value.toLowerCase();
                
                if (searchTerm.trim() === '') {
                    renderTenantsTable();
                    return;
                }
                
                const filteredTenants = tenants.filter(tenant => 
                    tenant.name.toLowerCase().includes(searchTerm) ||
                    tenant.roomNumber.toLowerCase().includes(searchTerm) ||
                    tenant.idCard.toLowerCase().includes(searchTerm)
                );
                
                renderTenantsTable(filteredTenants);
            });
            
            // Enter key for search
            document.getElementById('search-tenant').addEventListener('keyup', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('search-btn').click();
                }
            });
            
            // Event delegation for dynamic elements
            document.addEventListener('click', function(e) {
                // Edit tenant
                if (e.target.classList.contains('edit-tenant')) {
                    const tenantId = e.target.getAttribute('data-id');
                    const tenant = tenants.find(t => t.id === tenantId);
                    
                    if (tenant) {
                        document.getElementById('tenant-modal-title').textContent = 'Edit Tenant';
                        document.getElementById('tenant-id').value = tenant.id;
                        document.getElementById('tenant-name').value = tenant.name;
                        document.getElementById('tenant-phone').value = tenant.phone;
                        document.getElementById('tenant-address').value = tenant.address;
                        document.getElementById('tenant-id-card').value = tenant.idCard;
                        document.getElementById('move-in-date').value = tenant.moveInDate;
                        
                        // Populate room options and set current room
                        populateRoomOptions();
                        document.getElementById('room-number').value = tenant.roomNumber;
                        
                        document.getElementById('room-type').value = tenant.roomType;
                        document.getElementById('deposit-amount').value = tenant.depositAmount;
                        document.getElementById('rent-amount').value = tenant.rentAmount;
                        
                        document.getElementById('tenant-modal').style.display = 'flex';
                    }
                }
                
                // Add payment for tenant
                if (e.target.classList.contains('add-payment')) {
                    const tenantId = e.target.getAttribute('data-id');
                    
                    document.getElementById('payment-modal-title').textContent = 'Add Payment';
                    document.getElementById('payment-form').reset();
                    document.getElementById('payment-tenant-id').value = tenantId;
                    populateTenantOptions();
                    document.getElementById('payment-tenant').value = tenantId;
                    document.getElementById('payment-date').value = new Date().toISOString().slice(0, 16);
                    document.getElementById('payment-modal').style.display = 'flex';
                }
                
                // Delete tenant
                if (e.target.classList.contains('delete-tenant')) {
                    if (confirm('Are you sure you want to delete this tenant?')) {
                        const tenantId = e.target.getAttribute('data-id');
                        
                        // Remove tenant
                        tenants = tenants.filter(t => t.id !== tenantId);
                        
                        // Remove associated payments
                        payments = payments.filter(p => p.tenantId !== tenantId);
                        
                        // Save to localStorage
                        localStorage.setItem('tenants', JSON.stringify(tenants));
                        localStorage.setItem('payments', JSON.stringify(payments));
                        
                        // Update UI
                        updateRoomOccupancy();
                        renderTenantsTable();
                        renderRecentPayments();
                        updateDashboardStats();
                        populateTenantOptions();
                    }
                }
                
                // Edit utility payment
                if (e.target.classList.contains('edit-utility')) {
                    // Implementation for editing utility payments
                    alert('Edit utility functionality would be implemented here');
                }
                
                // Delete utility payment
                if (e.target.classList.contains('delete-utility')) {
                    if (confirm('Are you sure you want to delete this utility payment?')) {
                        const utilityId = e.target.getAttribute('data-id');
                        
                        // Remove utility payment
                        utilities = utilities.filter(u => u.id !== utilityId);
                        
                        // Save to localStorage
                        localStorage.setItem('utilities', JSON.stringify(utilities));
                        
                        // Update UI
                        renderUtilityPayments();
                    }
                }
            });
        }
        
        // Initialize the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>